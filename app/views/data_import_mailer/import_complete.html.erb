<!DOCTYPE html>
<html>
  <head>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
  </head>
  <body>
    <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px;">
      <h2 style="color: #333;">Data Import Complete</h2>
      
      <p>Hello <%= @user.display_name %>,</p>
      
      <p>Your data import for <strong><%= @model_name %></strong> has been completed.</p>
      
      <div style="background-color: #f5f5f5; padding: 15px; border-radius: 5px; margin: 20px 0;">
        <h3 style="margin-top: 0;">Import Summary</h3>
        <ul style="list-style: none; padding: 0;">
          <li style="padding: 5px 0;">
            <strong>Successful:</strong> 
            <span style="color: #28a745;"><%= @result[:success_count] %></span>
          </li>
          <li style="padding: 5px 0;">
            <strong>Failed:</strong> 
            <span style="color: #dc3545;"><%= @result[:error_count] %></span>
          </li>
        </ul>
      </div>

      <% if @failed_rows.any? %>
        <div style="margin-top: 30px;">
          <h3 style="color: #dc3545;">Failed Rows</h3>
          <p>The following rows could not be imported:</p>
          
          <table style="width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 12px;">
            <thead>
              <tr style="background-color: #dc3545; color: white;">
                <th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Row #</th>
                <th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Data</th>
                <th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Error(s)</th>
              </tr>
            </thead>
            <tbody>
              <% @failed_rows.each do |error| %>
                <tr style="border-bottom: 1px solid #ddd;">
                  <td style="padding: 8px; border: 1px solid #ccc; font-weight: bold;">
                    <%= error[:row] || 'N/A' %>
                  </td>
                  <td style="padding: 8px; border: 1px solid #ccc;">
                    <pre style="margin: 0; font-size: 11px; white-space: pre-wrap; max-width: 300px; overflow-x: auto;"><%= error[:data].to_json rescue 'N/A' %></pre>
                  </td>
                  <td style="padding: 8px; border: 1px solid #ccc; color: #dc3545;">
                    <ul style="margin: 0; padding-left: 20px;">
                      <% (error[:errors] || []).each do |err| %>
                        <li><%= err %></li>
                      <% end %>
                    </ul>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% end %>

      <p style="margin-top: 30px; color: #666; font-size: 12px;">
        This is an automated message from the HBS Data Processing system.
      </p>
    </div>
  </body>
</html>

<% 
  steps = [
    { key: :pending, label: "Pending" },
    { key: :compliance_setup, label: "Compliance Setup" },
    { key: :billing_setup, label: "Billing Setup" },
    { key: :terms_agreement, label: "Terms & Agreement" },
    { key: :activated, label: "Activated" }
  ]
  
  current_status = organization.activation_status.to_sym
  current_order = Organization.activation_statuses[current_status] || 0
%>

<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
  <h3 class="text-sm font-semibold text-gray-900 mb-3">Activation Steps</h3>
  
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <% steps.each do |step| %>
            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">
              <%= step[:label] %>
            </th>
          <% end %>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <tr>
          <% steps.each do |step| %>
            <% 
              step_order = Organization.activation_statuses[step[:key]]
              # Handle nil step_order (if key doesn't exist in enum)
              if step_order.nil?
                is_completed = false
              else
                is_completed = step_order < current_order || (step_order == current_order && current_status == :activated)
              end
            %>
            <td class="px-3 py-2 whitespace-nowrap text-center">
              <% if is_completed %>
                <svg class="w-5 h-5 text-green-600 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
              <% else %>
                <span class="text-gray-300">â€”</span>
              <% end %>
            </td>
          <% end %>
        </tr>
      </tbody>
    </table>
  </div>
  
  <!-- Progress Percentage -->
  <div class="mt-3 pt-3 border-t border-gray-200">
    <div class="flex items-center justify-between text-xs">
      <span class="text-gray-600 font-medium">Progress</span>
      <span class="text-gray-900 font-semibold"><%= organization.activation_progress_percentage %>%</span>
    </div>
  </div>
</div>


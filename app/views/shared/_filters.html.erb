<%# Reusable filters partial for index pages %>
<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
  <%= form_with url: request.path, method: :get, local: true, class: "flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4" do |f| %>
    <!-- Hidden fields for model_audits -->
    <% if @auditable_type.present? && @auditable_id.present? %>
      <%= f.hidden_field :auditable_type, value: @auditable_type %>
      <%= f.hidden_field :auditable_id, value: @auditable_id %>
    <% end %>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 flex-1">
    <!-- Search field -->
    <% if @search_placeholder.present? %>
      <div>
        <%= f.label :search, "Search", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.text_field :search, value: params[:search], placeholder: @search_placeholder, class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
    <% end %>

    <!-- Status filter -->
    <% if @status_options.present? %>
      <div>
        <%= f.label :action_type, "Action", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :action_type, options_for_select([["All Actions", ""]] + @status_options.map { |s| s.is_a?(Array) ? s : [s.humanize, s] }, params[:action_type]), {}, class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
    <% end %>

    <!-- User filter -->
    <% if @user_options.present? %>
      <div>
        <%= f.label :user_id, "User", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :user_id, options_for_select([["All Users", ""]] + @user_options.map { |o| o.is_a?(Array) ? o : [o.email, o.id] }, params[:user_id]), {}, class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
    <% end %>

    <!-- Organization filter -->
    <% if @organization_options.present? %>
      <div>
        <%= f.label :organization_id, "Organization", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :organization_id, options_for_select([["All Organizations", ""]] + @organization_options.map { |o| o.is_a?(Array) ? o : [o.name, o.id] }, params[:organization_id]), {}, class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
    <% end %>

    <!-- Role filter -->
    <% if @role_options.present? %>
      <div>
        <%= f.label :role_id, "Role", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :role_id, options_for_select([["All Roles", ""]] + @role_options.map { |r| r.is_a?(Array) ? r : [r.role_name, r.id] }, params[:role_id]), {}, class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
    <% end %>

    <!-- Provider filter -->
   

    <!-- Service month filter -->
    <% if @service_month_options.present? %>
      <div>
        <%= f.label :service_month, "Service Month", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :service_month, options_for_select([["All Months", ""]] + @service_month_options.map { |m| [m, m] }, params[:service_month]), {}, class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
    <% end %>

    <!-- Specialty filter -->
    <% if @specialty_options.present? %>
      <div>
        <%= f.label :specialty_id, "Specialty", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :specialty_id, options_for_select([["All Specialties", ""]] + @specialty_options.map { |s| s.is_a?(Array) ? s : [s.name, s.id] }, params[:specialty_id]), {}, class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
    <% end %>

    <!-- Past due filter -->
    <% if @show_past_due %>
      <div>
        <%= f.label :past_due, "Past Due", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :past_due, options_for_select([["All Invoices", ""], ["Past Due Only", "true"]], params[:past_due]), {}, class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
    <% end %>

    <!-- Extra select filter (for auditable_type) -->
    <% if @extra_select.present? %>
      <div>
        <%= f.label :auditable_type, "Model Type", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :auditable_type, options_for_select([["All Models", ""]] + @extra_select.map { |t| [t, t] }, params[:auditable_type]), {}, class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
    <% end %>

    <!-- Time filter -->
    <% if @show_time_filter %>
      <div>
        <%= f.label :time_filter, "Time Period", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :time_filter, options_for_select([
          ["All Appointments", ""],
          ["Upcoming", "upcoming"],
          ["Past", "past"],
          ["Today", "today"],
          ["This Week", "this_week"],
          ["This Month", "this_month"]
        ], params[:time_filter]), {}, class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
    <% end %>

    <!-- Patient filter -->
    <% if @patient_options.present? %>
      <div>
        <%= f.label :patient_id, "Patient", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :patient_id, options_for_select([["All Patients", ""]] + @patient_options.map { |p| p.is_a?(Array) ? p : [p.full_name, p.id] }, params[:patient_id]), {}, class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
    <% end %>

    <!-- Location filter -->
    <% if @location_options.present? %>
      <div>
        <%= f.label :location_id, "Location", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :location_id, options_for_select([["All Locations", ""]] + @location_options.map { |l| l.is_a?(Array) ? l : [l.name, l.id] }, params[:location_id]), {}, class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
    <% end %>

    <!-- Billing channel filter -->
    <% if @billing_channel_options.present? %>
      <div>
        <%= f.label :billing_channel, "Billing Channel", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :billing_channel, options_for_select([["All Channels", ""]] + @billing_channel_options.map { |b| [b.humanize, b] }, params[:billing_channel]), {}, class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
    <% end %>

    <!-- Cascaded filter -->
    <% if @cascaded_options.present? %>
      <div>
        <%= f.label :cascaded_filter, "Cascaded", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :cascaded_filter, options_for_select([["All", ""], ["Not Cascaded", "not_cascaded"], ["Cascaded", "cascaded"]], params[:cascaded_filter]), {}, class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
    <% end %>

    <!-- Date range filters -->
    <% if @show_date_range %>
      <div>
        <%= f.label :date_from, "From Date", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.date_field :date_from, value: params[:date_from], class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
      <div>
        <%= f.label :date_to, "To Date", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.date_field :date_to, value: params[:date_to], class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
    <% end %>

    <!-- Insurance Plan filter -->
    <% if @insurance_plan_options.present? %>
      <div>
        <%= f.label :insurance_plan_id, "Insurance Plan", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :insurance_plan_id, options_for_select([["All Plans", ""]] + @insurance_plan_options.map { |p| p.is_a?(Array) ? p : [p.name, p.id] }, params[:insurance_plan_id]), {}, class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
    <% end %>

    <!-- Network Type filter -->
    <% if @network_type_options.present? %>
      <div>
        <%= f.label :network_type, "Network Type", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :network_type, options_for_select([["All Types", ""]] + @network_type_options.map { |n| n.is_a?(Array) ? n : [n.humanize, n] }, params[:network_type]), {}, class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
    <% end %>

    <!-- Enrollment Status filter -->
    <% if @enrollment_status_options.present? %>
      <div>
        <%= f.label :enrollment_status, "Enrollment Status", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :enrollment_status, options_for_select([["All Statuses", ""]] + @enrollment_status_options.map { |s| s.is_a?(Array) ? s : [s.humanize, s] }, params[:enrollment_status]), {}, class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
    <% end %>

    <!-- Coverage Order filter -->
    <% if @coverage_order_options.present? %>
      <div>
        <%= f.label :coverage_order, "Coverage Order", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :coverage_order, options_for_select([["All Orders", ""]] + @coverage_order_options.map { |o| o.is_a?(Array) ? o : [o.humanize, o] }, params[:coverage_order]), {}, class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>
    <% end %>

    </div>

    <!-- Action buttons -->
    <div class="flex items-end space-x-2">
      <%= f.submit "Filter", class: "bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-md transition-colors" %>
      <%= link_to "Clear", request.path, class: "text-gray-600 hover:text-gray-800 py-2 px-4" %>
    </div>
  <% end %>
</div>

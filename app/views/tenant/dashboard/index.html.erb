<!-- Main content area (renders inside application layout's content region) -->
<div class="p-0 md:p-0">
      <!-- Critical Resources Warning -->
      <% if @current_organization.has_missing_critical_resources? %>
        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-6 mb-6">
          <div class="flex">
            <div class="flex-shrink-0">
              <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="ml-3 flex-1">
              <h3 class="text-sm font-medium text-yellow-800">
                Action Required: Missing Critical Resources
              </h3>
              <div class="mt-2 text-sm text-yellow-700">
                <p>Your organization is missing critical resources needed for full functionality:</p>
                <ul class="list-disc list-inside mt-2 space-y-1">
                  <% @current_organization.missing_critical_resources.each do |resource| %>
                    <li><%= resource %></li>
                  <% end %>
                </ul>
                <div class="mt-4">
                  <%= link_to "View Settings & Add Resources", tenant_organization_setting_path, class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-yellow-800 bg-yellow-100 hover:bg-yellow-200" %>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>

      <% if @current_organization.tier_percentage&.in?([6.0, 7.0, 8.0, 9.0]) %>
        <!-- Tiered Practice Dashboard (6% / 7% tiers) -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
          <!-- Patient and Claim Totals -->
          <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Patient and Claim Totals</h2>
            <dl class="space-y-2 text-sm text-gray-700">
              <div class="flex justify-between">
                <dt class="font-medium">
                  <%= link_to "Total Patients:", tenant_patients_path, 
                      class: "text-blue-600 hover:text-green-600 transition-colors underline cursor-pointer" %>
                </dt>
                <dd><%= @total_patients || 0 %></dd>
              </div>
              <div class="flex justify-between">
                <dt class="font-medium">
                  <%= link_to "Active Patients:", tenant_patients_path(status: "active"), 
                      class: "text-blue-600 hover:text-green-600 transition-colors underline cursor-pointer" %>
                </dt>
                <dd><%= @active_patients || 0 %></dd>
              </div>
              <div class="flex justify-between">
                <dt class="font-medium">
                  <%= link_to "Total Claims:", tenant_encounters_path, 
                      class: "text-blue-600 hover:text-green-600 transition-colors underline cursor-pointer" %>
                </dt>
                <dd><%= @total_claims || 0 %></dd>
              </div>
              <div class="flex justify-between">
                <dt class="font-medium">
                  <%= link_to "Claims in Process:", tenant_encounters_path(submitted_filter: "submitted"), 
                      class: "text-blue-600 hover:text-green-600 transition-colors underline cursor-pointer" %>
                </dt>
                <dd><%= @claims_in_process || 0 %></dd>
              </div>
              <div class="flex justify-between">
                <dt class="font-medium">
                  <%= link_to "Claims Paid:", tenant_encounters_path(submitted_filter: "submitted", claim_status: "paid_in_full"), 
                      class: "text-blue-600 hover:text-green-600 transition-colors underline cursor-pointer" %>
                </dt>
                <dd><%= @claims_paid || 0 %></dd>
              </div>
              <div class="flex justify-between">
                <dt class="font-medium">
                  <%= link_to "Claims Denied:", tenant_encounters_path(submitted_filter: "submitted", claim_status: "denied"), 
                      class: "text-blue-600 hover:text-green-600 transition-colors underline cursor-pointer" %>
                </dt>
                <dd><%= @claims_denied || 0 %></dd>
              </div>
            </dl>
          </div>

          <!-- Revenue -->
          <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Revenue</h2>
            <dl class="space-y-2 text-sm text-gray-700">
              <div class="flex justify-between">
                <dt class="font-medium">Total Paid (Lifetime):</dt>
                <dd>$<%= number_with_precision(@total_paid_lifetime || 0, precision: 0, delimiter: ',') %></dd>
              </div>
              <div class="flex justify-between">
                <dt class="font-medium">Year-to-Date Paid:</dt>
                <dd>$<%= number_with_precision(@year_to_date_paid || 0, precision: 0, delimiter: ',') %></dd>
              </div>
              <div class="flex justify-between">
                <dt class="font-medium">Last 30 Days Paid:</dt>
                <dd>$<%= number_with_precision(@last_30_days_paid || 0, precision: 0, delimiter: ',') %></dd>
              </div>
              <div class="flex justify-between">
                <dt class="font-medium">Last 7 Days Paid:</dt>
                <dd>$<%= number_with_precision(@last_7_days_paid || 0, precision: 0, delimiter: ',') %></dd>
              </div>
              <div class="flex justify-between">
                <dt class="font-medium">Est. Outstanding A/R $</dt>
                <dd>$<%= number_with_precision(@est_outstanding_ar || 0, precision: 0, delimiter: ',') %></dd>
              </div>
            </dl>
          </div>

          <!-- Upcoming Expirations -->
          <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Upcoming Expirations</h2>
            <dl class="space-y-2 text-sm text-gray-700">
              <div class="flex justify-between">
                <dt class="font-medium">Expiring Prescriptions:</dt>
                <dd class="text-blue-600 font-semibold"><%= @expiring_prescriptions_count || 0 %></dd>
              </div>
              <div class="flex justify-between">
                <dt class="font-medium">Visit Caps Approaching:</dt>
                <dd class="text-blue-600 font-semibold"><%= @visit_caps_approaching_count || 0 %></dd>
              </div>
              <div class="flex justify-between">
                <dt class="font-medium">Auth Expirations:</dt>
                <dd class="text-blue-600 font-semibold"><%= @auth_expirations_count || 0 %></dd>
              </div>
            </dl>
          </div>
        </div>

        <!-- Recent Encounters and Patients Tables (for 6% / 7% tiers) -->
        <% unless @current_organization.tier_percentage&.in?([8.0, 9.0]) %>
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-4">
            <!-- Recent Encounters -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200">
              <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900">Recent Encounters</h2>
              </div>
              <div class="px-6 py-4 overflow-x-auto">
                <% if @recent_encounters&.any? %>
                  <table class="min-w-full divide-y divide-gray-200 text-sm">
                    <thead class="bg-gray-50">
                      <tr>
                        <th class="px-4 py-2 text-left font-medium text-gray-500 uppercase tracking-wider">Date</th>
                        <th class="px-4 py-2 text-left font-medium text-gray-500 uppercase tracking-wider">Patient</th>
                        <th class="px-4 py-2 text-left font-medium text-gray-500 uppercase tracking-wider">Status</th>
                        <th class="px-4 py-2 text-right font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                      </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                      <% @recent_encounters.each do |encounter| %>
                        <tr>
                          <td class="px-4 py-2 whitespace-nowrap"><%= encounter.date_of_service&.strftime("%m/%d/%Y") || format_in_organization_tz(encounter.created_at, "%m/%d/%Y") %></td>
                          <td class="px-4 py-2 whitespace-nowrap">
                            <%= link_to encounter.patient&.full_name || "N/A", tenant_patient_path(encounter.patient), 
                                class: "text-blue-600 hover:text-green-600 transition-colors underline cursor-pointer" %>
                          </td>
                          <td class="px-4 py-2 whitespace-nowrap">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                              <%= encounter.tenant_visible_status_label %>
                            </span>
                          </td>
                          <td class="px-4 py-2 whitespace-nowrap text-right">
                            <%= link_to "View", tenant_encounter_path(encounter), 
                                class: "text-blue-600 hover:text-green-600 transition-colors underline cursor-pointer" %>
                          </td>
                        </tr>
                      <% end %>
                    </tbody>
                  </table>
                <% else %>
                  <p class="text-sm text-gray-500">No recent encounters.</p>
                <% end %>
              </div>
            </div>

            <!-- Recent Patients -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200">
              <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900">Recent Patients</h2>
              </div>
              <div class="px-6 py-4 overflow-x-auto">
                <% if @recent_patients&.any? %>
                  <table class="min-w-full divide-y divide-gray-200 text-sm">
                    <thead class="bg-gray-50">
                      <tr>
                        <th class="px-4 py-2 text-left font-medium text-gray-500 uppercase tracking-wider">Name</th>
                        <th class="px-4 py-2 text-left font-medium text-gray-500 uppercase tracking-wider">DOB</th>
                        <th class="px-4 py-2 text-left font-medium text-gray-500 uppercase tracking-wider">Status</th>
                        <th class="px-4 py-2 text-right font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                      </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                      <% @recent_patients.each do |patient| %>
                        <tr>
                          <td class="px-4 py-2 whitespace-nowrap">
                            <%= link_to patient.full_name, tenant_patient_path(patient), 
                                class: "text-blue-600 hover:text-green-600 transition-colors underline cursor-pointer" %>
                          </td>
                          <td class="px-4 py-2 whitespace-nowrap"><%= patient.dob&.strftime("%m/%d/%Y") || "—" %></td>
                          <td class="px-4 py-2 whitespace-nowrap">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                              <%= patient.status.humanize %>
                            </span>
                          </td>
                          <td class="px-4 py-2 whitespace-nowrap text-right">
                            <%= link_to "View", tenant_patient_path(patient), 
                                class: "text-blue-600 hover:text-green-600 transition-colors underline cursor-pointer" %>
                          </td>
                        </tr>
                      <% end %>
                    </tbody>
                  </table>
                <% else %>
                  <p class="text-sm text-gray-500">No recent patients.</p>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>

        <% if @current_organization.tier_percentage&.in?([8.0, 9.0]) %>
          <!-- Advanced sections for 8% / 9% tiers -->
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Claim Age Summaries -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
              <h2 class="text-lg font-semibold text-gray-900 mb-4">Claim Age Summaries</h2>
              <dl class="space-y-2 text-sm text-gray-700">
                <div class="flex justify-between">
                  <dt class="font-medium">0–30 Days:</dt>
                  <dd><%= @claim_age_0_30 || 0 %></dd>
                </div>
                <div class="flex justify-between">
                  <dt class="font-medium">31–60 Days:</dt>
                  <dd><%= @claim_age_31_60 || 0 %></dd>
                </div>
                <div class="flex justify-between">
                  <dt class="font-medium">61–90 Days:</dt>
                  <dd><%= @claim_age_61_90 || 0 %></dd>
                </div>
                <div class="flex justify-between">
                  <dt class="font-medium">91–120 Days:</dt>
                  <dd><%= @claim_age_91_120 || 0 %></dd>
                </div>
                <div class="flex justify-between">
                  <dt class="font-medium">120+ Days:</dt>
                  <dd><%= @claim_age_120_plus || 0 %></dd>
                </div>
              </dl>
            </div>

            <!-- Averages & Projections -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
              <h2 class="text-lg font-semibold text-gray-900 mb-4">Averages &amp; Projections</h2>
              <dl class="space-y-2 text-sm text-gray-700">
                <div class="flex justify-between">
                  <dt class="font-medium">Avg Revenue Per Visit:</dt>
                  <dd>$<%= number_with_precision(@avg_revenue_per_visit || 0, precision: 0, delimiter: ',') %></dd>
                </div>
                <div class="flex justify-between">
                  <dt class="font-medium">Avg Revenue Per Provider:</dt>
                  <dd>$<%= number_with_precision(@avg_revenue_per_provider || 0, precision: 0, delimiter: ',') %></dd>
                </div>
                <div class="flex justify-between">
                  <dt class="font-medium">Avg Monthly Revenue:</dt>
                  <dd>$<%= number_with_precision(@avg_monthly_revenue || 0, precision: 0, delimiter: ',') %></dd>
                </div>
                <div class="flex justify-between">
                  <dt class="font-medium">Visits Per Month:</dt>
                  <dd><%= number_with_precision(@visits_per_month || 0, precision: 0, delimiter: ',') %></dd>
                </div>
                <div class="flex justify-between">
                  <dt class="font-medium">Avg Days to Payment:</dt>
                  <dd><%= @avg_days_to_payment || 0 %></dd>
                </div>
                <div class="flex justify-between">
                  <dt class="font-medium">Projected 30-Day Revenue:</dt>
                  <dd>$<%= number_with_precision(@projected_30_day_revenue || 0, precision: 0, delimiter: ',') %></dd>
                </div>
                <div class="flex justify-between">
                  <dt class="font-medium">Projected 90-Day Revenue:</dt>
                  <dd>$<%= number_with_precision(@projected_90_day_revenue || 0, precision: 0, delimiter: ',') %></dd>
                </div>
              </dl>
            </div>

            <!-- Claim Percentages -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
              <h2 class="text-lg font-semibold text-gray-900 mb-4">Claim Percentages</h2>
              <dl class="space-y-2 text-sm text-gray-700">
                <div class="flex justify-between">
                  <dt class="font-medium">Paid Claim Rate:</dt>
                  <dd><%= @paid_claim_rate || 0 %>% (This Month)</dd>
                </div>
                <div class="flex justify-between">
                  <dt class="font-medium">Denial Rate:</dt>
                  <dd><%= @denial_rate || 0 %>% (This Month)</dd>
                </div>
                <div class="flex justify-between">
                  <dt class="font-medium">Outstanding %:</dt>
                  <dd><%= @outstanding_percent || 0 %>% (This Month)</dd>
                </div>
              </dl>
            </div>
          </div>

          <!-- Previous 7 Day Lookback -->
          <div class="mt-4">
            <div class="bg-white rounded-lg shadow-sm border border-gray-200">
              <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900">Previous 7 Day Lookback</h2>
              </div>
              <div class="px-6 py-4 overflow-x-auto">
                <% if @recent_payments_7d&.any? %>
                  <table class="min-w-full divide-y divide-gray-200 text-sm">
                    <thead class="bg-gray-50">
                      <tr>
                        <th class="px-4 py-2 text-left font-medium text-gray-500 uppercase tracking-wider">Paid Date</th>
                        <th class="px-4 py-2 text-left font-medium text-gray-500 uppercase tracking-wider">Patient</th>
                        <th class="px-4 py-2 text-left font-medium text-gray-500 uppercase tracking-wider">Service Type</th>
                        <th class="px-4 py-2 text-left font-medium text-gray-500 uppercase tracking-wider">Service Date</th>
                        <th class="px-4 py-2 text-right font-medium text-gray-500 uppercase tracking-wider">Paid Amount</th>
                      </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                      <% @recent_payments_7d.each do |payment| %>
                        <% pa = payment.payment_applications.first %>
                        <% claim = pa&.claim %>
                        <% enc = claim&.encounter %>
                        <% patient = enc&.patient %>
                        <% service_type = enc&.specialty&.name || pa&.claim_line&.procedure_code&.description || "N/A" %>
                        <tr>
                          <td class="px-4 py-2 whitespace-nowrap"><%= payment.payment_date&.strftime("%m/%d/%Y") || format_in_organization_tz(payment.created_at, "%m/%d/%Y") %></td>
                          <td class="px-4 py-2 whitespace-nowrap"><%= patient&.full_name || "N/A" %></td>
                          <td class="px-4 py-2 whitespace-nowrap"><%= service_type %></td>
                          <td class="px-4 py-2 whitespace-nowrap"><%= enc&.date_of_service&.strftime("%m/%d/%Y") || "N/A" %></td>
                          <td class="px-4 py-2 whitespace-nowrap text-right">$<%= number_with_precision((payment.amount_total || payment.amount || 0), precision: 2, delimiter: ',') %></td>
                        </tr>
                      <% end %>
                    </tbody>
                  </table>
                <% else %>
                  <p class="text-sm text-gray-500">No payments in the last 7 days.</p>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>

<%
  results = check_result["results"] || {}
  summary = results["summary"] || {}
  summary_data = summary["data"] || {}
  summary_text = summary_data["text"].to_s.strip
  summary_status = summary["status"].to_s
  edi_error = results.dig("edi", "error")
  call_error = results.dig("call", "error")
%>
<div id="eligibility-result-<%= Time.current.to_i %>" class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-4">
  <h3 class="text-lg font-medium text-gray-900 mb-4">Eligibility result</h3>
  <dl class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-4">
    <div>
      <dt class="font-medium text-gray-500">Check ID</dt>
      <dd class="mt-1 text-gray-900 font-mono text-xs"><%= check_result["checkId"] %></dd>
    </div>
    <div>
      <dt class="font-medium text-gray-500">Completed</dt>
      <dd class="mt-1 text-gray-900"><%= check_result["completed"] == true ? "Yes" : "No" %></dd>
    </div>
    <div>
      <dt class="font-medium text-gray-500">Created</dt>
      <dd class="mt-1 text-gray-900"><%= check_result["createdAt"] %></dd>
    </div>
    <div>
      <dt class="font-medium text-gray-500">Updated</dt>
      <dd class="mt-1 text-gray-900"><%= check_result["updatedAt"] %></dd>
    </div>
  </dl>

  <% if summary_text.present? %>
    <div class="mb-4">
      <h4 class="text-sm font-medium text-gray-700 mb-2">Eligibility summary</h4>
      <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 text-sm text-gray-800 whitespace-pre-line"><%= summary_text %></div>
      <% if summary_status.present? %>
        <p class="mt-1 text-xs text-gray-500">Summary status: <%= summary_status %></p>
      <% end %>
    </div>
  <% end %>

  <% if edi_error.present? || call_error.present? %>
    <div class="mb-4 space-y-2">
      <h4 class="text-sm font-medium text-gray-700">Verification notes</h4>
      <% if edi_error.present? %>
        <div class="bg-amber-50 border border-amber-200 rounded-lg p-3 text-sm">
          <span class="font-medium text-amber-800">EDI:</span>
          <span class="text-amber-800"><%= edi_error["message"] || edi_error["code"] %></span>
        </div>
      <% end %>
      <% if call_error.present? %>
        <div class="bg-amber-50 border border-amber-200 rounded-lg p-3 text-sm">
          <span class="font-medium text-amber-800">Call:</span>
          <span class="text-amber-800"><%= call_error["message"] || call_error["code"] %></span>
        </div>
      <% end %>
    </div>
  <% end %>

  <% if results.present? %>
    <details class="mt-2">
      <summary class="text-sm font-medium text-blue-600 cursor-pointer hover:text-blue-800">View raw results</summary>
      <pre class="mt-2 text-xs bg-gray-50 p-3 rounded-md overflow-x-auto max-h-64 border border-gray-200"><%= JSON.pretty_generate(results) %></pre>
    </details>
  <% end %>
</div>

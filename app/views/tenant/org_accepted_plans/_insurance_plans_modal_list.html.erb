<% search_query = local_assigns.fetch(:search_query, "") %>
<% payer_required = local_assigns.fetch(:payer_required, false) %>
<%= turbo_frame_tag "insurance_plans_modal_list" do %>
  <div class="border border-gray-200 rounded-lg overflow-hidden bg-white max-h-80 overflow-y-auto">
    <% if payer_required %>
      <div class="px-4 py-8 text-center text-sm text-gray-500">
        Select a payer above to see and select plans.
      </div>
    <% else %>
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50 sticky top-0">
          <tr>
            <th class="px-4 py-2 text-left">
              <label class="inline-flex items-center gap-2 cursor-pointer">
                <input type="checkbox"
                       id="insurance_plans_select_all"
                       class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                       aria-label="Select all">
                <span class="text-xs font-medium text-gray-500 uppercase tracking-wider">Select all</span>
              </label>
            </th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Plan</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% if insurance_plans.any? %>
            <% insurance_plans.each do |plan| %>
              <tr class="hover:bg-gray-50">
                <td class="px-4 py-2 whitespace-nowrap">
                  <input type="checkbox"
                         name="insurance_plan_ids[]"
                         value="<%= plan.id %>"
                         class="insurance-plan-checkbox h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                </td>
                <td class="px-4 py-2 text-sm text-gray-900"><%= plan.name %></td>
              </tr>
            <% end %>
          <% else %>
            <tr>
              <td colspan="2" class="px-4 py-8 text-center text-sm text-gray-500">
                <%= search_query.present? ? "No plans match your search." : "No plans available to add for this payer (all may already be accepted)." %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>
  </div>
<% end %>

<style>
  html, body { background: #f9fafb; color: #111827; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
  * { box-sizing: border-box; }
  .min-h-screen { min-height: 100vh; }
  .w-full { width: 100%; }
  .mx-auto { margin-left: auto; margin-right: auto; }
  .px-4 { padding-left: 1rem; padding-right: 1rem; }
  .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
  .p-6 { padding: 1.5rem; }
  .mb-8 { margin-bottom: 2rem; }
  .mb-4 { margin-bottom: 1rem; }
  .space-y-6 > * + * { margin-top: 1.5rem; }
  .grid { display: grid; }
  .grid-cols-1 { grid-template-columns: 1fr; }
  .lg\:grid-cols-3 { grid-template-columns: 1fr; }
  @media (min-width: 1024px) { .lg\:grid-cols-3 { grid-template-columns: 2fr 1fr 0; } .lg\:col-span-2 { grid-column: span 2 / span 2; } }
  .flex { display: flex; }
  .justify-between { justify-content: space-between; }
  .items-center { align-items: center; }
  .items-start { align-items: flex-start; }
  .bg-white { background-color: #ffffff; }
  .bg-gray-50 { background-color: #f9fafb; }
  .rounded-lg { border-radius: 0.5rem; }
  .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05); }
  .border { border-width: 1px; border-style: solid; }
  .border-gray-200 { border-color: #e5e7eb; }
  .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
  .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
  .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
  .text-xs { font-size: 0.75rem; line-height: 1rem; }
  .font-bold { font-weight: 700; }
  .font-semibold { font-weight: 600; }
  .font-medium { font-weight: 500; }
  .text-gray-900 { color: #111827; }
  .text-gray-700 { color: #374151; }
  .text-gray-600 { color: #4b5563; }
  .text-gray-500 { color: #6b7280; }
  .text-gray-400 { color: #9ca3af; }
  .inline-flex { display: inline-flex; }
  .px-2\.5 { padding-left: 0.625rem; padding-right: 0.625rem; }
  .py-0\.5 { padding-top: 0.125rem; padding-bottom: 0.125rem; }
  .rounded-full { border-radius: 9999px; }
  .bg-gray-100 { background-color: #f3f4f6; }
  .text-gray-800 { color: #1f2937; }
  .bg-yellow-100 { background-color: #fef3c7; }
  .text-yellow-800 { color: #92400e; }
  .bg-blue-100 { background-color: #dbeafe; }
  .text-blue-800 { color: #1e40af; }
  .bg-green-100 { background-color: #d1fae5; }
  .text-green-800 { color: #065f46; }
  .bg-red-100 { background-color: #fee2e2; }
  .text-red-800 { color: #991b1b; }
  .text-red-600 { color: #dc2626; }
  .text-green-600 { color: #16a34a; }
  table { border-collapse: collapse; width: 100%; }
  th { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #6b7280; text-align: left; padding: 0.75rem 1.5rem; background: #f9fafb; }
  td { padding: 1rem 1.5rem; border-top: 1px solid #e5e7eb; font-size: 0.875rem; color: #111827; vertical-align: top; }
  .whitespace-nowrap { white-space: nowrap; }
  .min-w-full { width: 100%; }
  .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
  .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
  .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
</style>
<style>
  body { font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; color: #333; margin: 0; padding: 0; }
  .invoice-container { max-width: 800px; margin: 0 auto; padding: 20px; }
  .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px; }
  .company-info h1 { font-size: 24px; font-weight: bold; margin: 0 0 5px 0; color: #2c3e50; }
  .company-info p { margin: 0; color: #666; }
  .logo { text-align: right; }
  .logo img { max-height: 60px; }
  .invoice-details { display: flex; justify-content: space-between; margin-bottom: 30px; }
  .bill-to, .invoice-info { width: 45%; }
  .bill-to h3, .invoice-info h3 { font-size: 14px; font-weight: bold; margin: 0 0 10px 0; color: #2c3e50; }
  .bill-to p, .invoice-info p { margin: 2px 0; }
  .status-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; text-transform: uppercase; }
  .status-paid { background: #d4edda; color: #155724; }
  .status-issued { background: #fff3cd; color: #856404; }
  .status-draft { background: #f8d7da; color: #721c24; }
  .status-partially_paid { background: #cce5ff; color: #004085; }
  .status-voided { background: #f5c6cb; color: #721c24; }
  .items-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
  .items-table th { background: #f8f9fa; padding: 10px; text-align: left; font-weight: bold; font-size: 11px; text-transform: uppercase; border: 1px solid #dee2e6; }
  .items-table td { padding: 10px; border: 1px solid #dee2e6; }
  .items-table .text-right { text-align: right; }
  .totals { width: 300px; margin-left: auto; }
  .totals table { width: 100%; border-collapse: collapse; }
  .totals td { padding: 5px 10px; border: none; }
  .totals .total-row { border-top: 2px solid #333; font-weight: bold; }
  .payments-section { margin-top: 30px; }
  .payments-table { width: 100%; border-collapse: collapse; }
  .payments-table th { background: #f8f9fa; padding: 8px; text-align: left; font-weight: bold; font-size: 10px; text-transform: uppercase; border: 1px solid #dee2e6; }
  .payments-table td { padding: 8px; border: 1px solid #dee2e6; font-size: 11px; }
</style>

<div class="invoice-container">
  <!-- Header -->
  <div class="header">
    <div class="company-info">
      <h1>INVOICE</h1>
      <p>Holistic Business Solutions</p>
    </div>
    <div class="logo">
      <%= image_tag "HBS-logo-scaled (1).png", alt: "HBS Logo", style: "max-height: 60px;" %>
    </div>
  </div>

  <!-- Invoice Details -->
  <div class="invoice-details">
    <div class="bill-to">
      <h3>Bill To:</h3>
      <p><strong><%= @invoice.organization.name %></strong></p>
      <p><%= @invoice.organization.subdomain %>.localhost:3000</p>
      <p><%= @invoice.organization.owner.email %></p>
    </div>
    <div class="invoice-info">
      <h3>Invoice Details:</h3>
      <p><strong>Invoice #:</strong> <%= @invoice.invoice_number || "Draft" %></p>
      <p><strong>Date:</strong> <%= @invoice.issue_date&.strftime("%B %d, %Y") || "—" %></p>
      <p><strong>Due Date:</strong> <%= @invoice.due_date&.strftime("%B %d, %Y") || "—" %></p>
      <p><strong>Status:</strong> <span class="status-badge status-<%= @invoice.status %>"><%= @invoice.status.humanize %></span></p>
    </div>
  </div>

  <!-- Line Items -->
  <table class="items-table">
    <thead>
      <tr>
        <th>Description</th>
        <th class="text-right">Quantity</th>
        <th class="text-right">Unit Price</th>
        <th class="text-right">Amount</th>
      </tr>
    </thead>
    <tbody>
      <% @invoice.invoice_line_items.each do |item| %>
        <tr>
          <td><%= item.description %></td>
          <td class="text-right"><%= item.quantity || "—" %></td>
          <td class="text-right"><%= item.unit_price ? "$#{number_with_precision(item.unit_price, precision: 2)}" : "—" %></td>
          <td class="text-right"><strong>$<%= number_with_precision(item.amount, precision: 2) %></strong></td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <!-- Totals -->
  <div class="totals">
    <table>
      <tr>
        <td>Subtotal:</td>
        <td class="text-right">$<%= number_with_precision(@invoice.subtotal, precision: 2) %></td>
      </tr>
      <tr>
        <td>Total:</td>
        <td class="text-right">$<%= number_with_precision(@invoice.total, precision: 2) %></td>
      </tr>
      <tr>
        <td>Amount Paid:</td>
        <td class="text-right">$<%= number_with_precision(@invoice.amount_paid, precision: 2) %></td>
      </tr>
      <tr class="total-row">
        <td>Amount Due:</td>
        <td class="text-right">$<%= number_with_precision(@invoice.amount_due, precision: 2) %></td>
      </tr>
    </table>
  </div>

  <!-- Payments -->
  <% if @payments.any? %>
    <div class="payments-section">
      <h3>Payment History</h3>
      <table class="payments-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Method</th>
            <th class="text-right">Amount</th>
            <th>Status</th>
            <th>Reference</th>
          </tr>
        </thead>
        <tbody>
          <% @payments.each do |payment| %>
            <tr>
              <td><%= (payment.paid_at || payment.created_at).strftime("%b %d, %Y") %></td>
              <td><%= payment.payment_method.humanize %></td>
              <td class="text-right">$<%= number_with_precision(payment.amount, precision: 2) %></td>
              <td><span class="status-badge status-<%= payment.payment_status %>"><%= payment.payment_status.humanize %></span></td>
              <td><%= payment.payment_provider_id || "—" %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>
</div>


